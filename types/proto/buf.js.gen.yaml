---
version: v1
plugins:
  # Generates .ts files
  - plugin: buf.build/bufbuild/es:v1.2.0
    opt: target=ts
    out: ../../workers/javascript/packages/types/src
  # generates js message files (pinned to v3.21.2 for google-protobuf compatibility)
  - plugin: buf.build/protocolbuffers/js:v3.21.2
    out: ../gen/js
    opt: import_style=commonjs
  # generates js message files for javascript-plugins-sandbox
  - plugin: buf.build/protocolbuffers/js:v3.21.2
    out: ../../workers/ephemeral/javascript-plugins-sandbox/src/types
    opt: import_style=commonjs
  # generates js server / client stubs files
  - name: grpc
    out: ../gen/js
    opt: grpc_js
    path: grpc_tools_node_protoc_plugin
  # generates js server / client stubs files for javascript-plugins-sandbox
  - name: grpc
    out: ../../workers/ephemeral/javascript-plugins-sandbox/src/types
    opt: grpc_js
    path: grpc_tools_node_protoc_plugin
  # generates .d.ts files
  - name: ts
    out: ../gen/js
    opt: grpc_js
  # generates .d.ts files for javascript-plugins-sandbox
  - name: ts
    out: ../../workers/ephemeral/javascript-plugins-sandbox/src/types
    opt: grpc_js
